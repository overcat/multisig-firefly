(function(t){function e(e){for(var a,o,i=e[0],l=e[1],c=e[2],d=0,h=[];d<i.length;d++)o=i[d],s[o]&&h.push(s[o][0]),s[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,i=1;i<n.length;i++){var l=n[i];0!==s[l]&&(a=!1)}a&&(r.splice(e--,1),t=o(o.s=n[0]))}return t}var a={},s={app:0},r=[];function o(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=a,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)o.d(n,a,function(e){return t[e]}.bind(null,a));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/multisig-firefly/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},1:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5023:function(t,e,n){"use strict";var a=n("d71b"),s=n.n(a);s.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("f751"),n("097d");var a=n("2b0e"),s=n("bb71");n("da64");a["a"].use(s["a"],{iconfont:"md"});var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("AppLayout")],1)},o=[],i=(n("a481"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:{disabled:t.state.loading}},[n("v-dialog",{attrs:{"hide-overlay":"",persistent:""},model:{value:t.state.loading,callback:function(e){t.$set(t.state,"loading",e)},expression:"state.loading"}},[n("v-card",{attrs:{color:"primary",dark:""}},[n("v-card-text",[t._v("Loading\n                "),n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}})],1)],1)],1),n("router-view")],1)}),l=[],c={accountId:null,appVersion:null,enabledMulti:null,loading:!0,horizonUrl:null,networkPassphrase:null,accountName:null},u=c,d={name:"AppLayout",data:function(){return{state:u}}},h=d,f=(n("de2e"),n("2877")),g=n("6544"),p=n.n(g),v=n("b0af"),_=n("99d9"),m=n("169a"),b=n("8e36"),w=Object(f["a"])(h,i,l,!1,null,null,null),y=w.exports;p()(w,{VCard:v["a"],VCardText:_["b"],VDialog:m["a"],VProgressLinear:b["a"]});var x=n("c4de"),k="multisig.tools",T="",V=new x["a"](k,T),S=V,I=n("79e2"),D=n.n(I),A=null;function C(){console.log("initServer: "+u.networkPassphrase+" "+u.horizonUrl),"test"===u.networkPassphrase||"Public Global Stellar Network ; September 2015"===u.networkPassphrase?D.a.Network.usePublicNetwork():D.a.Network.useTestNetwork(),A=new D.a.Server(u.horizonUrl)}function M(){return A}var O=n("bc3a"),P=n.n(O),j=null;function L(){var t="Public Global Stellar Network ; September 2015"===u.networkPassphrase||"test"===u.networkPassphrase?"https://multisig.tools/":"https://testnet.multisig.tools/";j=P.a.create({baseURL:t,timeout:1e4,transformRequest:function(t,e){e["Content-Type"]="application/x-www-form-urlencoded";var n=[];for(var a in t)t.hasOwnProperty(a)&&void 0!==t[a]&&n.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return n.join("&")}})}function E(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return j.get("/transactions/".concat(t,"?limit=").concat(e,"&offset=").concat(n))}function $(t){return j.get("/transaction/".concat(t))}function q(t){return j.post("/transactions",{tx:t})}function R(t,e){return j.post("/transaction/".concat(t),{tx:e})}var U={name:"App",components:{AppLayout:y},data:function(){return{state:u}},created:function(){var t=this;this.state.loading=!0,S.ready().then(function(e){console.log("firefly wallet is ready!"),t.state.appVersion=e.version,t.state.accountId=e.address,t.state.horizonUrl=e.horizonUrl,t.state.networkPassphrase=e.network,t.state.accountName=e.accountName,console.log(t.state),C(),L(),t.$router.replace({name:"home"}),t.state.loading=!1}).catch(function(t){console.error(t)})}},N=U,z=Object(f["a"])(N,r,o,!1,null,null,null),X=z.exports,B=n("8c4f"),W=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-card",[n("v-img",{staticClass:"white--text",attrs:{height:"200px",src:"https://cdn.vuetifyjs.com/images/cards/docks.jpg"}},[n("v-container",{attrs:{"fill-height":"",fluid:""}},[n("v-layout",{attrs:{"fill-height":""}},[n("v-flex",{attrs:{xs12:"","align-end":"",flexbox:""}},[n("span",{staticClass:"headline"},[t._v(t._s(t.state.accountName))])])],1)],1)],1),n("v-card-actions",[t.state.enabledMulti?n("v-btn",{attrs:{flat:"",color:"orange"},on:{click:t.goToPayment}},[t._v("New Payment")]):n("v-btn",{attrs:{flat:"",color:"orange"},on:{click:t.goToEnable}},[t._v("Enable Multi-signature Service")])],1)],1),n("v-list",{attrs:{"two-line":""}},[t._l(t.handledTransactions,function(e){return[n("v-list-tile",{key:e.id,attrs:{avatar:"",ripple:""},on:{click:function(n){return t.goToDetail(e.realId)}}},[n("v-list-tile-content",[n("v-list-tile-title",[t._v(t._s(e.id))]),n("v-list-tile-sub-title",{staticClass:"text--primary"},[t._v(t._s(e.source))]),n("v-list-tile-sub-title",[t._v(t._s(e.info))])],1),n("v-list-tile-action",[n("v-list-tile-action-text",[t._v(t._s(e.time))]),n("v-icon",[t._v(t._s(e.status))])],1)],1)]})],2)],1)},Y=[],F=n("59ad"),H=n.n(F),G=(n("ac6a"),n("28a5"),n("768b")),J=n("79e2");function K(t){var e=t.replace(/^web\+stellar:/,"").split("?",2),n=Object(G["a"])(e,2),a=(n[0],n[1]),s=new URLSearchParams(a);return s.get("xdr")}function Q(t){var e=[],n=new J.Transaction(t),a=n.operations;return a.forEach(function(t){switch(t.type){case"createAccount":e.push({type:"createAccount",destination:t.destination,amount:t.startingBalance,asset:{code:"XLM",issuer:void 0}});break;case"payment":e.push({type:"payment",destination:t.destination,amount:t.amount,asset:t.asset});break;default:e.push({type:"unknown"})}}),{source:n.source,operations:e}}var Z=n("5a0c"),tt=n.n(Z),et={data:function(){return{state:u,transactions:null,handledTransactions:null}},mounted:function(){var t=this;E(u.accountId,100).then(function(e){t.transactions=e.data,t.handleTransactions()}).catch(function(t){return console.log(t)}),null===this.state.enabledMulti&&this.fetchAccount()},methods:{fetchAccount:function(){var t=this;this.state.loading=!0,M().loadAccount(u.accountId).then(function(e){var n=e.signers.filter(function(t){return"ed25519_public_key"===t.type});u.enabledMulti=!(1===n.length&&n[0].key===u.accountId),t.state.loading=!1})},goToPayment:function(){this.$router.push({name:"payment"})},goToEnable:function(){this.$router.push({name:"enable-multi-signature"})},handleTransactions:function(){var t=[];this.transactions.forEach(function(e){var n,a=Q(K(e.request_uri)),s=[];n=e.signers.filter(function(t){return t.key===u.accountId})[0].signed?"done":"add",null!==e.horizon_response&&(n=200!==e.horizon_response.status?"block":"done_all"),a.operations.forEach(function(t){"unknown"!==t.type&&s.push("".concat(t.asset.code,"(").concat(H()(t.amount).toFixed(2),")"))}),t.push({time:tt()(e.created_at).format("YYYY-MM-DD HH:mm:ss"),source:a.source,id:"".concat(e.id.substr(0,12),"...").concat(e.id.substr(-12)),info:s.join(" "),realId:e.id,status:n})}),this.handledTransactions=t},goToDetail:function(t){this.$router.push({name:"detail",params:{txId:t}})}}},nt=et,at=n("8336"),st=n("a523"),rt=n("0e8f"),ot=n("132d"),it=n("adda"),lt=n("a722"),ct=n("8860"),ut=n("ba95"),dt=n("40fe"),ht=n("5d23"),ft=Object(f["a"])(nt,W,Y,!1,null,null,null),gt=ft.exports;p()(ft,{VBtn:at["a"],VCard:v["a"],VCardActions:_["a"],VContainer:st["a"],VFlex:rt["a"],VIcon:ot["a"],VImg:it["a"],VLayout:lt["a"],VList:ct["a"],VListTile:ut["a"],VListTileAction:dt["a"],VListTileActionText:ht["a"],VListTileContent:ht["b"],VListTileSubTitle:ht["c"],VListTileTitle:ht["d"]});var pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("h1",[t._v("Settings")]),n("form",[n("h2",[t._v("Signers")]),t._l(t.signers,function(e,a){return n("span",[n("h4",[t._v("Signer "+t._s(a+1))]),n("span",{staticClass:"address"},[t._v("AccountID: "+t._s(e.signer_address))]),n("br"),t._v("\n            Weight: "+t._s(e.signer_weight)),n("br")])}),n("v-text-field",{attrs:{type:"text",label:"Account ID",required:""},model:{value:t.signer_address,callback:function(e){t.signer_address=e},expression:"signer_address"}}),n("v-text-field",{attrs:{type:"number",label:"Weight",required:""},model:{value:t.signer_weight,callback:function(e){t.signer_weight=t._n(e)},expression:"signer_weight"}})],2),n("v-btn",{attrs:{block:"",color:"secondary",dark:""},on:{click:t.addSigner}},[t._v("Add Signer")]),n("form",[n("h2",[t._v("Thresholds")]),n("v-text-field",{attrs:{type:"number",label:"master_key_weight",required:""},model:{value:t.master_key_weight,callback:function(e){t.master_key_weight=t._n(e)},expression:"master_key_weight"}}),n("v-text-field",{attrs:{type:"number",label:"high_threshold",required:""},model:{value:t.high_threshold,callback:function(e){t.high_threshold=t._n(e)},expression:"high_threshold"}}),n("v-text-field",{attrs:{type:"number",label:"med_threshold",required:""},model:{value:t.med_threshold,callback:function(e){t.med_threshold=t._n(e)},expression:"med_threshold"}}),n("v-text-field",{attrs:{type:"number",label:"low_threshold",required:""},model:{value:t.low_threshold,callback:function(e){t.low_threshold=t._n(e)},expression:"low_threshold"}}),n("v-btn",{attrs:{block:"",color:"blue"},on:{click:t.submit}},[t._v("Submit")])],1),n("v-dialog",{attrs:{"max-width":"290"},model:{value:t.errorDialog,callback:function(e){t.errorDialog=e},expression:"errorDialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Error")]),n("v-card-text",[t._v("\n                "+t._s(t.errorMsg)+"\n            ")]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"green darken-1",flat:"flat"},on:{click:function(e){t.errorDialog=!1}}},[t._v("\n                    OK\n                ")])],1)],1)],1)],1)},vt=[],_t=n("0a0d"),mt=n.n(_t),bt={data:function(){return{state:u,master_key_weight:1,high_threshold:2,med_threshold:2,low_threshold:2,signers:[],signer_address:null,signer_weight:1,errorDialog:!1,errorMsg:null}},methods:{addSigner:function(){this.signers.push({signer_address:this.signer_address,signer_weight:this.signer_weight}),this.signer_address=null,this.signer_weight=1},submit:function(){var t=this;if(!this.checkWeightAndThreshold())return console.log("checkWeightAndThreshold == false"),this.errorMsg="The sum of the Weights must be greater than high_threshold.",void(this.errorDialog=!0);this.state.loading=!0,M().loadAccount(u.accountId).then(function(e){var n=new D.a.TransactionBuilder(e,{fee:100,timebounds:{minTime:0,maxTime:Math.floor(mt()()/1e3)+43200}});t.signers.forEach(function(t){n=n.addOperation(D.a.Operation.setOptions({signer:{weight:t.signer_weight,ed25519PublicKey:t.signer_address}}))}),n=n.addOperation(D.a.Operation.setOptions({masterWeight:t.master_key_weight,lowThreshold:t.low_threshold,medThreshold:t.med_threshold,highThreshold:t.high_threshold})),n=n.build();var a=n.toXDR("base64");S.signXDR(a).then(function(e){var n=new D.a.Transaction(e);M().submitTransaction(n).then(function(e){t.state.loading=!1,t.state.enabledMulti=!0,t.$router.push({name:"home"})}).catch(function(e){console.log(e),t.state.loading=!1,t.errorMsg="It looks like the submission failed. Please try again later.",t.errorDialog=!0})})}).catch(function(e){console.log(e),t.state.loading=!1,t.errorMsg="Load account failed. Please try again later.",t.errorDialog=!0})},checkWeightAndThreshold:function(){var t=this.master_key_weight+this.signers.reduce(function(t,e){return t+e.signer_weight},0);return t>=this.high_threshold}}},wt=bt,yt=(n("5023"),n("12b2")),xt=n("9910"),kt=n("2677"),Tt=Object(f["a"])(wt,pt,vt,!1,null,"222b7e98",null),Vt=Tt.exports;p()(Tt,{VBtn:at["a"],VCard:v["a"],VCardActions:_["a"],VCardText:_["b"],VCardTitle:yt["a"],VContainer:st["a"],VDialog:m["a"],VSpacer:xt["a"],VTextField:kt["a"]});var St=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("h1",[t._v("Payment")]),n("form",{attrs:{"data-app":""}},[n("v-text-field",{attrs:{type:"text",label:"Destination",required:""},model:{value:t.destination,callback:function(e){t.destination=e},expression:"destination"}}),n("v-select",{attrs:{name:"asset","item-text":"asset.asset_code","item-value":"asset",items:t.assets,label:"Asset"},model:{value:t.asset,callback:function(e){t.asset=e},expression:"asset"}}),n("v-text-field",{attrs:{type:"number",label:"Amount",required:""},model:{value:t.amount,callback:function(e){t.amount=e},expression:"amount"}})],1),n("v-btn",{attrs:{block:"",color:"secondary",dark:""},on:{click:t.submit}},[t._v("Submit")])],1)},It=[],Dt={data:function(){return{state:u,destination:null,amount:null,assets:[],asset:null}},created:function(){var t=this;this.state.loading=!0,S.getBalances().then(function(e){e.forEach(function(e){var n="native"===e.asset_type;t.assets.push({asset:{asset_code:n?"XLM":e.asset_code,asset_issuer:n?null:e.asset_issuer}})}),t.state.loading=!1}).catch(function(t){console.error(t)})},methods:{submit:function(){var t=this;this.state.loading=!0,M().loadAccount(u.accountId).then(function(e){var n=new D.a.TransactionBuilder(e,{fee:100,timebounds:{minTime:0,maxTime:Math.floor(mt()()/1e3)+10368e3}}).addOperation(D.a.Operation.payment({destination:t.destination,amount:t.amount,asset:new D.a.Asset(t.asset.asset_code,t.asset.asset_issuer)}));n=n.build();var a=n.toXDR("base64");console.log(a),S.signXDR(a).then(function(e){q(e).then(function(e){t.state.loading=!1,t.$router.push({name:"detail",params:{txId:e.data.id}})}).catch(function(e){console.log(e),t.state.loading=!1})})}).catch(function(e){t.state.loading=!1,console.log(e)})}}},At=Dt,Ct=n("b56d"),Mt=Object(f["a"])(At,St,It,!1,null,null,null),Ot=Mt.exports;p()(Mt,{VBtn:at["a"],VContainer:st["a"],VSelect:Ct["a"],VTextField:kt["a"]});var Pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",[n("h1",[t._v("Detail")]),n("h2",[t._v("Info")]),t._v("\n    ID: "+t._s(t.handleTxId(this.data.id))),n("br"),t._v("\n    Created at: "+t._s(t.handleTime(this.data.created_at))),n("br"),t._v("\n    Updated at: "+t._s(t.handleTime(this.data.updated_at))),n("br"),n("span",{staticClass:"address"},[t._v("Source: "+t._s(t.source))]),n("br"),t._v("\n    Status: "),n("strong",[t._v(t._s(t.handleStatus(this.status)))]),n("br"),n("h2",[t._v("XDR Info")]),t._l(t.operations,function(e,a){return n("div",[n("h3",[t._v("Operation "+t._s(a+1))]),t._v("\n        Type: "+t._s(e.type)),n("br"),e.type!==t.unkown?n("div",[n("span",{staticClass:"address"},[t._v("Destination: "+t._s(e.destination))]),n("br"),t._v("\n            Asset: "+t._s(e.asset.code)+"\n            "),e.asset.issuer?n("span",[t._v("("),n("span",{staticClass:"address"},[t._v(t._s(e.asset.issuer))]),t._v(")")]):t._e(),n("br"),t._v("\n            Amount: "+t._s(e.amount)+"\n        ")]):t._e()])}),n("h2",[t._v("Signers")]),t._l(t.data.signers,function(e,a){return n("div",[n("h3",[t._v("Signer "+t._s(a+1)),e.key===t.state.accountId?n("span",[t._v("(Me)")]):t._e()]),n("span",{staticClass:"address"},[t._v("Address: "+t._s(e.key)+"\n        ")]),n("br"),t._v("\n        Weight: "+t._s(e.weight)),n("br"),t._v("\n        Signed: "+t._s(e.signed)+"\n    ")])}),n("v-btn",{attrs:{block:"",color:"blue",disabled:0!==t.status||t.signed},on:{click:t.submit}},[t._v(t._s(t.btnMsg))])],2)},jt=[],Lt={data:function(){return{state:u,txId:this.$route.params.txId,data:null,status:null,signed:!1,xdr:null,btnMsg:"Sign",operations:null,source:null}},mounted:function(){this.fetchTx()},methods:{fetchTx:function(){var t=this;this.state.loading=!0,$(this.txId).then(function(e){t.data=e.data,t.handleRequestUri(),t.signed=t.data.signers.filter(function(t){return t.key===u.accountId})[0].signed,t.signed&&(t.btnMsg="Signed"),t.xdr=K(t.data.request_uri),null===t.data.horizon_response?t.status=0:t.data.horizon_response&&(200!==t.data.horizon_response.status?t.status=2:t.status=1),t.state.loading=!1}).catch(function(e){t.state.loading=!1,console.log(e)})},submit:function(){var t=this;this.state.loading=!0,S.signXDR(this.xdr).then(function(e){var n=new D.a.Transaction(e),a=n.toEnvelope().toXDR("base64");console.log(a),R(t.txId,a).then(function(e){t.fetchTx(),t.status.loading=!1,t.fetchTx()}).catch(function(e){t.status.loading=!1,t.fetchTx(),console.log(e)})})},handleTime:function(t){return tt()(t).format("YYYY-MM-DD HH:mm:ss")},handleStatus:function(t){switch(t){case 0:return"Panding";case 1:return"Success";case 2:return"Failed"}},handleRequestUri:function(){var t=Q(K(this.data.request_uri));this.source=t.source,this.operations=t.operations},handleTxId:function(t){return"".concat(t.substr(0,12),"...").concat(t.substr(-12))}}},Et=Lt,$t=(n("9dd8"),Object(f["a"])(Et,Pt,jt,!1,null,"5e802f8d",null)),qt=$t.exports;p()($t,{VBtn:at["a"],VContainer:st["a"]}),a["a"].use(B["a"]);var Rt=[{path:"/home",name:"home",component:gt},{path:"/enable-multi-signature",name:"enable-multi-signature",component:Vt},{path:"/payment",name:"payment",component:Ot},{path:"/detail/:txId",name:"detail",component:qt}],Ut=new B["a"]({routes:Rt}),Nt=Ut;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(X)},router:Nt}).$mount("#app")},"79d4":function(t,e,n){},8871:function(t,e,n){},"9dd8":function(t,e,n){"use strict";var a=n("8871"),s=n.n(a);s.a},d71b:function(t,e,n){},de2e:function(t,e,n){"use strict";var a=n("79d4"),s=n.n(a);s.a}});
//# sourceMappingURL=app.012b627a.js.map